---
title: "ãƒ‰ãƒ©ãƒƒã‚¯ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã§è¦ç´ ã‚’ä½œæˆã—ãŸã‚Šã€ä¸¦ã¹æ›¿ãˆãŸã‚Š"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React"]
published: true
---

## ã¯ã˜ã‚ã«

ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®æ™‚ã—ã‹ã‚Šã€TODO ãƒªã‚¹ãƒˆã®ä¸¦ã¹æ›¿ãˆã—ã‹ã‚Šã€ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹æ©Ÿä¼šã¯ãã‚Œãªã‚Šã«ã‚ã‚Šã¾ã™ã€‚
ã—ã‹ã—ã€ã„ã–è‡ªåˆ†ãŒå®Ÿè£…ã™ã‚‹ã¨ãªã‚‹ã¨ã©ã†ã—ã¦è‰¯ã„ã‹åˆ†ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã¨ã¯ã„ãˆã€ã“ã“ç›´è¿‘ã§ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒå‡ºã¦ããŸãŸã‚èª¿æŸ»ã—ã¦ã„ãŸã‚‰ã€[dnd kit](https://docs.dndkit.com/)ã¨ã„ã†ã„ã„æ„Ÿã˜ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã—ãŸã€‚
ãªã®ã§ã€ä»Šå›ã¯ã“ã®[dnd kit](https://docs.dndkit.com/)ã®ä½¿ã„æ–¹ã‚’è¦‹ã¦ã„ãã€æ´»ç”¨ç·¨ã¨ã—ã¦ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã§è¦ç´ ãŒç”Ÿæˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
çµæ§‹é•·ã„ã§ã™ãŒã€æ˜¯éãŠä»˜ãåˆã„ãã ã•ã„ã€‚

## ã“ã®è¨˜äº‹ã®ã“ã“ã ã‘!!!

ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã¯[dnd kit](https://docs.dndkit.com/)ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
ã“ã®æ©Ÿèƒ½ã¯ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã«åŠ ãˆã€ä¸¦ã¹æ›¿ãˆæ©Ÿèƒ½ã‚‚ã‚ã‚Šã¾ã™ã€‚
ä»¥ä¸Šã®æ©Ÿèƒ½ã‚’æ´»ã‹ã—ã¦ã€ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã‚‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‹•çš„ã«ç”Ÿæˆã§ãã¾ã™ã€‚
ç”Ÿæˆã—ãŸè¦ç´ ã®ä¸¦ã¹æ›¿ãˆã‚‚ã§ãã¾ã™ã€‚

## å®Œæˆå“

ã“ã®è¨˜äº‹ã§ã§ãã‚‹ã®ã¯ä»¥ä¸‹ã®ã‚‚ã®ã¨ãªã£ã¦ã„ã¾ã™ã€‚
![newcreateElmDragAndDrop.gif](/images/drag-and-drop-by-dnd-kit/newcreateElmDragAndDrop.gif)
ã‚³ãƒ¼ãƒ‰ã®å…¨ä½“åƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã«ã¤ã„ã¦ã€å…¨ä½“çš„ãªç®¡ç†ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```jsx
import { DndContext, DragEndEvent, DragOverEvent, DragStartEvent, Modifier } from "@dnd-kit/core";
import { useState } from "react";
import DropComponent from "./DropComponent";
import { arrayMove } from "@dnd-kit/sortable";
import { v4 as uuidv4 } from 'uuid'
import { restrictToVerticalAxis } from "@dnd-kit/modifiers";
import DragComponent from "./DragComponent";
export default function DragDropContext() {
    // ãƒ‰ãƒ­ãƒƒãƒ—ã§ãã‚‹é ˜åŸŸã«è¡¨ç¤ºã•ã‚Œã‚‹è¦ç´ ã®ãƒ‡ãƒ¼ã‚¿ç”¨ã®State
    const [elms, setElms] = useState<{ id: string, name: string }[]>([])
    // ãƒ‰ãƒ©ãƒƒã‚¯ä¸­ã®è¦ç´ ãƒ‡ãƒ¼ã‚¿ç”¨ã®State
    const [activeElm, setActiveElm] = useState<{ id: string, name: string, virtualId?: string }>()
    // ãƒ‰ãƒ©ãƒƒã‚¯ã™ã‚‹è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚‚ã®ã‹ã‚’åˆ¤å®šã™ã‚‹State
    const [isDropContent, setIsDropContent] = useState(false)
    // ãƒ‰ãƒ©ãƒƒã‚¯ã™ã‚‹æ–¹å‘ã®åˆ¶ç´„ã‚’ç®¡ç†ã™ã‚‹State
    // åŸºæœ¬çš„ã«ã€Œ@dnd-kit/modifiersã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®å€¤ã‚’ä»˜ä¸ã™ã‚‹
    const [modifiers, setModifiers] = useState<Modifier[]>([])
    // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã«ç™ºç«ã™ã‚‹é–¢æ•°
    const handleDragStart = (event: DragStartEvent) => {
        // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ã«é–¢ã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
        const { active } = event;
        // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å­˜åœ¨ã™ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹
        const isExistInDropContent = elms.map((i) => i.id).includes(active.id.toString());
        //ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸè¦ç´ ã®idä½œæˆã€‚ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ã§idã‚’ä½œæˆã™ã‚‹
        const id = isExistInDropContent ? active.id.toString() : uuidv4();
        // ãƒ‰ãƒ©ãƒƒã‚¯ä¸­ã«ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ä»®ç”Ÿæˆã•ã‚Œã‚‹è¦ç´ ã®IDã€‚ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®ã‚‚ã®ã‚’ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹ã¨ãã¯undefined
        const virtualId = isExistInDropContent ? undefined : uuidv4();
        setActiveElm({ id, name: active.data.current?.name, virtualId })
        setIsDropContent(isExistInDropContent)
        // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®ã‚‚ã®ã®å ´åˆã€å‹•ã‹ã›ã‚‹æ–¹å‘ã‚’å‚ç›´æ–¹å‘ã®ã¿ã«åˆ¶é™ã™ã‚‹
        isExistInDropContent ? setModifiers([restrictToVerticalAxis]) : setModifiers([])
    };
    // ãƒ‰ãƒ©ãƒƒã‚¯çµ‚äº†æ™‚ã«ç™ºç«ã™ã‚‹é–¢æ•°
    const handleDragEnd = (e: DragEndEvent) => {
        // å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã€‚
        // Stateã®seté–¢æ•°ã¯éåŒæœŸãªã®ã§ã€ã“ã“ã§å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚é–¢æ•°å†…ã®å‡¦ç†ã«ã¯å½±éŸ¿ãªã„ã€‚
        setActiveElm(undefined)
        // ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚¤ãƒ™ãƒ³ãƒˆ(over)ã‚’å–å¾—ã€‚
        const { over } = e;
        // ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãªã„å ´åˆã‚„ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå¤–ã§ãƒ‰ãƒ©ãƒƒã‚¯ã‚’è¾ã‚ãŸå ´åˆå‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹ã€‚
        if (!over || !activeElm) {
            setElms(() => elms.filter((elm) => elm.id !== activeElm?.virtualId))
            return
        };
        // ä»®è¦ç´ ã‚’å®Ÿéš›ã®è¦ç´ ã¨ã—ã¦ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã¸åæ˜ ã•ã›ã¦ã„ã‚‹
        setElms(() => elms.map((elm) => ({
            id: elm.id === activeElm.virtualId ? activeElm.id : elm.id,
            name: elm.name
        })))
        // ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãŸå ´åˆã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã‚‹
        if (elms.some((elm) => elm.id === activeElm.id)) {
            setElms((items) => {
                const oldIndex = items.map((i) => i.id).findIndex((val) => val === activeElm.id)
                const newIndex = items.map((i) => i.id).findIndex((val) => val === over.id)
                return arrayMove(items, oldIndex, newIndex);
            });
        }
    }
    const handleDragOver = (e: DragOverEvent) => {
        const { over } = e;
        //ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸå ´æ‰€ã«ã‚ã£ãŸè¦ç´ ã®id
        const overId = over?.id;
        // ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãªã„å ´åˆã‚„ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå¤–ã§ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ã‚’å‹•ã‹ã—ã¦ã„ã‚‹å ´åˆå‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹ã€‚
        if (!overId || !activeElm) {
            // ç”Ÿæˆã—ãŸä»®è¦ç´ ã‚’å‰Šé™¤ã™ã‚‹
            setElms(() => elms.filter((elm) => elm.id !== activeElm?.virtualId));
            return;
        };
        // ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å…¥ã£ãŸã‚‰è¦ç´ ã‚’è¿½åŠ ã™ã‚‹
        if (activeElm.virtualId && !elms.some((elm) => elm.id === activeElm.virtualId)) {
            setElms([...elms.slice(0, elms.length), { id: activeElm.virtualId, name: e.active.data.current?.name }])
        }
        // ä»®ã®è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å‹•ã‹ã—ã¦ã„ã‚‹æ™‚ã«ã€ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ã€‚
        if (elms.some((elm) => elm.id === activeElm.virtualId)) {
            setElms((items) => {
                const oldIndex = items.map((i) => i.id).findIndex((val) => val === activeElm.virtualId)
                const newIndex = items.map((i) => i.id).findIndex((val) => val === over.id)
                return arrayMove(items, oldIndex, newIndex);
            });
        }
    }
    return (
        <>
            <div style={{ display: 'flex' }}>
                <DndContext modifiers={modifiers} onDragEnd={(e) => handleDragEnd(e)} onDragOver={(e) => handleDragOver(e)} onDragStart={(e) => handleDragStart(e)}>
                    <DropComponent elms={elms} isDropContent={isDropContent} activeElmId={activeElm?.virtualId}>
                    </DropComponent>
                    <DragComponent></DragComponent>
                </DndContext>
            </div>
        </>
    )
}
```

ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```tsx
import { UniqueIdentifier, useDroppable } from "@dnd-kit/core";
import { SortableContext, rectSortingStrategy } from "@dnd-kit/sortable";
import SortDropContent from "./SortDropContent";
type Props = {
  elms: { id: UniqueIdentifier; name: string }[];
  activeElmId?: string;
  isDropContent?: boolean;
};
export default function DropComponent({
  elms,
  activeElmId,
  isDropContent = false,
}: Props) {
  const { isOver, setNodeRef: dropRef } = useDroppable({
    id: "droppable",
  });
  const dropStyle = {
    padding: "1rem 0 0 0",
    minHeight: "100px",
    width: "200px",
    border: isOver && !isDropContent ? "3px solid blue" : `1px solid`,
  };
  return (
    <div style={{ margin: "2rem" }}>
      <div ref={dropRef} style={dropStyle}>
        {/* ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ç¾¤ã€‚SortableContextã§å›²ã‚€ã“ã¨ã§ã€ä¸¦ã¹æ›¿ãˆã®è¨­å®šãŒã§ãã‚‹ */}
        <SortableContext items={elms} strategy={rectSortingStrategy}>
          {elms.map((elm) => {
            return (
              <SortDropContent
                key={elm.id}
                elm={elm}
                isVirtual={elm.id === activeElmId}
              ></SortDropContent>
            );
          })}
        </SortableContext>
      </div>
    </div>
  );
}
```

ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```tsx
import { UniqueIdentifier } from "@dnd-kit/core";
import { useSortable } from "@dnd-kit/sortable";
import { CSS } from "@dnd-kit/utilities";
type Props = {
  elm: { id: UniqueIdentifier; name: string };
  isVirtual: boolean;
};
export default function SortDropContent({ elm, isVirtual }: Props) {
  const {
    isDragging,
    // ä¸¦ã³æ›¿ãˆã®ã¤ã¾ã¿éƒ¨åˆ†ã«è¨­å®šã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    setActivatorNodeRef,
    listeners,
    // DOMå…¨ä½“ã«å¯¾ã—ã¦è¨­å®šã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    setNodeRef,
    transform,
    transition,
  } = useSortable({ id: elm.id });
  return (
    <div
      ref={setNodeRef}
      style={{
        transform: CSS.Transform.toString(transform),
        transition,
      }}
    >
      <p
        ref={setActivatorNodeRef}
        {...listeners}
        style={{
          cursor: isDragging ? "grabbing" : "grab",
          border: "1px solid",
          margin: "0 0 1rem 0",
          // ä»®ã§ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹è¦ç´ ã®å ´åˆã€è–„ãã™ã‚‹ã€‚
          opacity: isVirtual ? ".5" : "1",
        }}
      >
        {elm.name}
      </p>
    </div>
  );
}
```

ãƒ‰ãƒ©ãƒƒã‚¯ã§ãã‚‹è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```tsx
import { useDraggable } from "@dnd-kit/core";
export default function DragComponent() {
  const { attributes, listeners, setNodeRef, transform } = useDraggable({
    id: "draggable",
    data: { name: "test" },
  });
  const {
    attributes: attributes2,
    listeners: listeners2,
    setNodeRef: setNodeRef2,
    transform: transform2,
  } = useDraggable({
    id: "draggable2",
    data: { name: "test2" },
  });
  const {
    attributes: attributes3,
    listeners: listeners3,
    setNodeRef: setNodeRef3,
    transform: transform3,
  } = useDraggable({
    id: "draggable3",
    data: { name: "test3" },
  });
  const style = transform
    ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
      }
    : undefined;
  const style2 = transform2
    ? {
        transform: `translate3d(${transform2.x}px, ${transform2.y}px, 0)`,
      }
    : undefined;
  const style3 = transform3
    ? {
        transform: `translate3d(${transform3.x}px, ${transform3.y}px, 0)`,
      }
    : undefined;
  return (
    <div>
      <button ref={setNodeRef} style={style} {...listeners} {...attributes}>
        ãƒ†ã‚¹ãƒˆ
      </button>
      <button ref={setNodeRef2} style={style2} {...listeners2} {...attributes2}>
        ãƒ†ã‚¹ãƒˆ2
      </button>
      <button ref={setNodeRef3} style={style3} {...listeners3} {...attributes3}>
        ãƒ†ã‚¹ãƒˆ3
      </button>
    </div>
  );
}
```

## å°å…¥çµŒç·¯

React ã§ãƒ‰ãƒ©ãƒƒã‚¯ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚’èª¿ã¹ã‚‹ã¨ãã‚Œãªã‚Šã«è¨˜äº‹ã¯å‡ºã¦ãã¾ã™ã€‚
ãã—ã¦ã€[ã“ã¡ã‚‰ã®è¨˜äº‹](https://tech-blog.talentio.co.jp/entry/2023/03/28/143944)ã‚’å‚è€ƒã«ä»¥ä¸‹ 5 ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°ã‚’æ¯”è¼ƒã™ã‚‹ã¨[react-draggable](https://github.com/react-grid-layout/react-draggable)ãŒä¸€ç•ªäººæ°—ã¨ãªã£ã¦ã„ã¾ã™ã€‚
![[npm trendsã®æ¤œç´¢çµæœ](https://npmtrends.com/@dnd-kit/core-vs-clauderic/react-sortable-hoc-vs-react-beautiful-dnd-vs-react-dnd-vs-react-draggable-vs-react-sortable-hoc) ã‹ã‚‰å¼•ç”¨](/images/drag-and-drop-by-dnd-kit/2024-01-14_11h07_00.png)
[npm trends ã®æ¤œç´¢çµæœ](https://npmtrends.com/@dnd-kit/core-vs-clauderic/react-sortable-hoc-vs-react-beautiful-dnd-vs-react-dnd-vs-react-draggable-vs-react-sortable-hoc) ã‹ã‚‰å¼•ç”¨
ãªã‚‰ã€react-draggable ã‚’ä½¿ã£ã¦è¦‹ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸãŒã€è¨˜äº‹å†…ã§ã‚‚ã‚ã‚‹ã‚ˆã†ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒã‚ã¾ã‚Šã•ã‚Œã¦ãŠã‚‰ãšã€å¯¾å¿œã® React ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ 16 ã¨ 18 ç³»ã‚’æƒ³å®šã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚
Atlassian è£½ã® react-beautiful-dnd ã‚‚[package.json](https://github.com/atlassian/react-beautiful-dnd/blob/master/package.json#L120)ã‚’ç¢ºèªã™ã‚‹ã¨ã€18 ç³»ã‚’æƒ³å®šã—ã¦ã„ãªã•ãã†ã§ã™ã€‚
**[react-sortable-hoc](https://github.com/clauderic/react-sortable-hoc)**ã¯ dnd kit ã®å‰èº«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã®ã§ã€ä»Šä½¿ç”¨ã™ã‚‹æ„ç¾©ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãªã®ã§ã€[react-dnd](https://github.com/react-dnd/react-dnd)ã¨[dnd kit](https://github.com/clauderic/dnd-kit)ã®äºŒæŠã«ãªã‚Šã¾ã™ã€‚
æ­£ç›´ã©ã£ã¡ã§ã‚‚è‰¯ã•ãã†ã ã£ãŸã®ã§ã™ãŒã€react-dnd ã¯æœ€çµ‚æ›´æ–°æ—¥ãŒ 2 å¹´å‰ã¨ã‚ã¾ã‚Šæ›´æ–°ã¯ã•ã‚Œã¦ã„ãªã„ä¸€æ–¹ã§ã€dnd kit ã¯ 2 ãƒ¶æœˆå‰ã¨æ›´æ–°ãŒãã‚Œãªã‚Šã®é »åº¦è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚
ã¾ãŸã€2 ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Google æ¤œç´¢ã™ã‚‹ã¨ä½“æ„Ÿã§ã™ãŒã€dnd kit ã®æ–¹ãŒæ¯”è¼ƒçš„æœ€è¿‘ã®è¨˜äº‹ã‚’å¤šãè¦‹ã‹ã‘ã¾ã™ã€‚
ã‚ˆã£ã¦ã€ä»Šå¾Œã‚‚ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ dnd kit ã®æ–¹ãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«å¯¾ã—ã¦ã™ãã«å¯¾å¿œã—ã¦ãã‚Œãã†ã ã¨æ€ã„ dnd kit ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

## dnd kit ã¨ã¯

[dnd kit](https://dndkit.com/)ã¯ React ã§ä½¿ç”¨ã§ãã‚‹ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚
å€‹äººçš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ãŸã‚Šã€å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¦ä»¥ä¸‹ã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
â‘ 10kb ä»¥ä¸‹ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®¹é‡ãŒè»½ã„
â‘¡ ã‚¹ãƒãƒ›ç”»é¢ã§ã®ä½¿ç”¨ã—ã‚„ã™ã•ã‚‚è€ƒæ…®ã—ã¦ã„ã‚‹ã€‚
â‘¢ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½“ã§ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ãŒå®Œçµã™ã‚‹ã®ã§ã€å°å…¥ãŒã—ã‚„ã™ã„ã€‚
â‘£ ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã®ã«ä¸€ã¤ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨äºŒã¤ã®é–¢æ•°ã ã‘ã§å¯èƒ½ã¨ãªã‚‹
â‘¤ ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã‚‚ç°¡å˜ã«å°å…¥ã§ãã‚‹
â‘¥ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å°å…¥ã—ã‚„ã™ã„
ãã®ä»–ã«ã‚‚å¤šãã®æ©Ÿèƒ½ã‚„ç‰¹å¾´ã¯ã‚ã‚Šã¾ã™ãŒã€ç‰¹ã«åˆ©ç‚¹ã‚’æ„Ÿã˜ãŸã®ã¯ä¸Šè¨˜ã®é€šã‚Šã§ã™ã€‚
dnd kit ã®ç‰¹å¾´ã‚’ã–ã£ãã‚Šèª¬æ˜ã—ãŸã®ã§ã€å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## åŸºæœ¬çš„ãªå®Ÿè£…

### dnd kit ã®å°å…¥

React ãŒå®Ÿè¡Œã§ãã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€`npm install @dnd-kit/core @dnd-kit/modifiers @dnd-kit/sortable @dnd-kit/utilities`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
@dnd-kit/core ã¯ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æ”¯ãˆã‚‹ dnd kit ã®æ ¸ã¨ãªã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚
@dnd-kit/modifiers ã¯ãƒ‰ãƒ©ãƒƒã‚¯ã™ã‚‹æ–¹å‘ã‚’åˆ¶å¾¡ã™ã‚‹ã®ã‚’ä»Šå›è¡Œã£ã¦ã„ã‚‹ã®ã§ã€ãã®å¯¾å¿œã®ãŸã‚ã«å°å…¥ã—ã¦ã„ã¾ã™ã€‚
åŒæ§˜ã«@dnd-kit/sortable ã¯ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã€@dnd-kit/utilities ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œã®ãŸã‚ã«å°å…¥ã—ã¦ã„ã¾ã™ã€‚
å°å…¥ã¯ä»¥ä¸Šã¨ãªã‚Šã¾ã™ã€‚
åˆ¥é€”è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ã¯ãªãã€å¾Œã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«å‡¦ç†ã‚’æ›¸ãã ã‘ã§ã™ã€‚
ç°¡å˜ã§ã™ã­ã€‚
ãªãŠã€ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã¨ã¯ç›´æ¥é–¢ä¿‚ãªã„ã§ã™ãŒã€è¡¨ç¤ºã•ã›ã‚‹è¦ç´ ã® id ã‚’ uuid ã«ã™ã‚‹ãŸã‚ã«`npm install uuid`ã¨`npm i --save-dev @types/uuid`ã‚’å®Ÿè¡Œã—ã¦ã€uuid ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚
ãã‚Œã§ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

### ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®æº–å‚™ã¨ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã®å®Ÿè£…

ã“ã“ã§ã¯ã¾ãšåŸºæœ¬çš„ãªè¨­å®šã‚’è¡Œã„ã€ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚
ã¾ãšã¯è¦ç´ ã®ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ã†ãŸã‚ã®æº–å‚™ã‚’ã—ã¾ã™ã€‚
ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```tsx
import { DndContext, useDraggable } from "@dnd-kit/core";
import DraggableBase from "./DraggableBase";
export default function DndContextBase() {
  return (
    <DndContext>
      <DraggableBase></DraggableBase>
    </DndContext>
  );
}
```

DndContext ã¯[React Context API](https://react.dev/learn/passing-data-deeply-with-context)ã‚’ç”¨ã„ã¦å®Ÿè£…ã•ã‚Œã¦ã‚‹ã€ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã§ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã‚’è¡Œã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãªã£ã¦ã„ã¾ã™ã€‚
dnd kit ã®ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã‚„ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ã„ãŸã„å ´åˆã€ä½¿ç”¨ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¤–å´ã‚’ DndContext ã§å›²ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã§ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€æ¬¡ã«ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
DraggableBase ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¼‰ã—ã¾ã™ã€‚

```tsx
import { useDraggable } from "@dnd-kit/core";
export default function DraggableBase() {
    const {  listeners transform } = useDraggable({
        id: 'draggableTest',
        data: { name: 'test' }
    });
    const style = transform ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
    } : undefined;
    return (
        <button style={style}  {...listeners} >
            ãƒ†ã‚¹ãƒˆ
        </button>
    )
}
```

ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã‚’ä½¿ã†ã«ã¯[useDraggable](https://docs.dndkit.com/api-documentation/draggable/usedraggable)é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
useDraggable é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã®ã«å¿…è¦ãªã®ã¯ã€è¦ç´ ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ id ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚
ã“ã‚Œã‚’è¨­å®šã™ã‚Œã°ã€ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã ã€ã“ã®å¾Œãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹è¦ç´ ã®å€¤ã‚’ä½¿ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”Ÿæˆã—ãŸã„ã®ã§ã€è¦ç´ ãŒæŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©ã™ã‚‹ data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚è¨­å®šã—ã¦ã„ã¾ã™ã€‚
useDraggable é–¢æ•°ã®æˆ»ã‚Šå€¤ã«ã¤ã„ã¦ã§ã™ãŒã€ãƒ‰ãƒ©ãƒƒã‚¯æ©Ÿèƒ½ã‚’é–‹å§‹ã™ã‚‹ã®ã«å¿…è¦ãªã‚‚ã®ã¯`listeners`ã ã‘ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
`listeners`ã«ã¤ã„ã¦ã¯ã€useDraggable é–¢æ•°ã§è¨­å®šã—ãŸãƒ‰ãƒ©ãƒƒã‚¯ã®æ¤œçŸ¥ã‚’è¡Œã„ãŸã„è¦ç´ ã«ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ãŸã ã€ã“ã®ã¾ã¾ã§ã¯å‹•ã‹ã™è¨­å®šã¯ã§ããŸã¨ã—ã¦ã‚‚ç”»é¢ä¸Šå‹•ã„ã¦ã„ã‚‹ã‚ˆã†ã«ã¯ã§ãã¾ã›ã‚“ã€‚
ãã“ã§ã€transform ã®å€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
transform ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ä¸Šã§ã®è¦ç´ ã®åº§æ¨™ã‚’å–å¾—ã—ã¾ã™ã€‚
ã“ã®å€¤ã‚’ CSS ã«è¨­å®šã™ã‚‹ã“ã¨ã§è¦ç´ ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã“ã¾ã§ã§ããŸã®ã§ã€ä¸€æ—¦å‹•ã‹ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‰ãƒ©ãƒƒã‚¯ãŒã§ãã¾ã™ã€‚
![ReactDnDAnimation.gif](/images/drag-and-drop-by-dnd-kit/ReactDnDAnimation.gif)
å‹•ã‹ã™ã ã‘ãªã‚‰ã“ã‚Œã§ã„ã„ã®ã§ã™ãŒã€ä»Šå¾Œãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```tsx
import { useDraggable } from "@dnd-kit/core";
export default function DraggableBase() {
  const { listeners, setNodeRef, transform } = useDraggable({
    id: "draggableTest",
    data: { name: "test" },
  });
  const style = transform
    ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
      }
    : undefined;
  return (
    <button ref={setNodeRef} style={style} {...listeners}>
      ãƒ†ã‚¹ãƒˆ
    </button>
  );
}
```

ç€ç›®ã™ã¹ãç‚¹ã¯ ref å±æ€§ã«`setNodeRef`ã¨ã„ã†å€¤ã‚’è¨­å®šã—ã¦ã„ã‚‹ã“ã¨ã§ã™ã€‚
ã“ã‚ŒãŒãªã„ã¨ã€ä»–ã®è¦ç´ ã¨è¡çªã—ãŸã®ã‹ãªã©ã‚’æ¤œçŸ¥ã§ããšã€ã“ã®å¾Œå®Ÿè£…ã—ãŸã„æ©Ÿèƒ½ã«å½±éŸ¿ã‚’åŠã¼ã—ã¾ã™ã€‚
ãã®ãŸã‚ã€ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½å®Ÿè£…å‰ã«`setNodeRef`ã ã‘ã¯ä»˜ä¸ã—ã¦ãŠãã¾ã™ã€‚

### ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½

è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚¯ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€æ¬¡ã«ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```tsx
import { useDroppable } from "@dnd-kit/core";
export default function DrppabbleBase() {
  const { isOver, setNodeRef } = useDroppable({
    id: "droppableTest",
  });
  const dropStyle = {
    marginTop: "1rem",
    padding: "1rem 0 0 0",
    minHeight: "100px",
    width: "200px",
    border: isOver ? "3px solid blue" : `1px solid`,
  };
  return <div style={dropStyle} ref={setNodeRef}></div>;
}
```

æ³¨ç›®ã™ã¹ãã¯ useDroppable é–¢æ•°ã§ã™ã€‚
ã“ã®é–¢æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
useDroppable é–¢æ•°ã®å¼•æ•°ã«ã¯ã€ãƒ‰ãƒ­ãƒƒãƒ—å—ã‘å…¥ã‚Œè¦ç´ ã‚’ä¸€æ„ã«ç‰¹å®šã™ã‚‹ ID ãŒå¿…è¦ã§ã™ã€‚
ID ã¯å¿…é ˆã§ã™ãŒã€ä»Šå›ã¯ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãªã„ã®ã§ã€data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ç„¡ã—ã«ã—ã¾ã™ã€‚
æˆ»ã‚Šå€¤ã¨ã—ã¦ã¯ã€`isOver`ã¨`setNodeRef`ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
setNodeRef ã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å…¥ã£ã¦ããŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã«ä½¿ã†ã®ã§ã€å–å¾—ãŒåŸºæœ¬å¿…é ˆã®å€¤ã§ã™ã€‚
isOver ã¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸä¸Šã§ãƒ‰ãƒ©ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹å ´åˆã€true ã«ãªã‚Šã¾ã™ã€‚
ä»Šå›ã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸä¸Šã«ã„ã‚‹æ™‚ã«ã€ã‚¹ã‚¿ã‚¤ãƒ«ã®é©ç”¨ã‚’ã—ãŸã„ãŸã‚å–å¾—ã—ã¾ã—ãŸã€‚
ãƒ‰ãƒ­ãƒƒãƒ—ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚ä½œæˆã§ããŸã®ã§ã€è¦ªå´ã§å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx
import { DndContext, useDraggable } from "@dnd-kit/core";
import DraggableBase from "./DraggableBase";
import DrppabbleBase from "./DropabbleBase";
export default function DndContextBase() {
  return (
    <DndContext>
      <DraggableBase></DraggableBase>
      <DrppabbleBase></DrppabbleBase>
    </DndContext>
  );
}
```

ã“ã“ã¾ã§è¡Œã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸä¸Šã«ã„ã‚‹å ´åˆæ ãŒé’è‰²ã«ãªã‚Šã¾ã™ã€‚
![ReactDnDAnimationDropOnly.gif](/images/drag-and-drop-by-dnd-kit/ReactDnDAnimationDropOnly.gif)

### ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã¨ãã«ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«è¦ç´ ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

å…ˆç¨‹ã®äºŒã¤ã§ã€åŸºæœ¬çš„ãªãƒ‰ãƒ©ãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ãªã®ã§ã€ã“ã“ã§ã¯å°‘ã—ç™ºå±•ç³»ã¨ã—ã¦ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã‚‰è¦ç´ ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
æœ€åˆã«å®Œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç¤ºã—ã¾ã™ã€‚
ã¾ãšã¯ DndContext ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€DndContextBase é–¢æ•°ã«ã¤ã„ã¦ã§ã™ã€‚

```jsx
import { DndContext, DragEndEvent } from "@dnd-kit/core";
import DraggableBase from "./DraggableBase";
import DrppabbleBase from "./DropabbleBase";
import { useState } from "react";
import { v4 as uuidv4 } from 'uuid'
export default function DndContextBase() {
    const [items, setItems] = useState<{ id: string, name: string }[]>([])
    const handleDragEnd = (event: DragEndEvent) => {
        if (event.over) {
            setItems((prev) => [...prev, { id: uuidv4(), name: event.active.data.current?.name }])
        }
    }
    return (
        <DndContext onDragEnd={handleDragEnd}>
            <DraggableBase></DraggableBase>
            <DrppabbleBase items={items}></DrppabbleBase>
        </DndContext>
    )
}
```

æ¬¡ã«ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã‚’ç¤ºã™ DrppabbleBase é–¢æ•°å†…ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```jsx
import { useDroppable } from "@dnd-kit/core";
type Props = {
  items: { id: string, name: string }[],
};
export default function DrppabbleBase({ items }: Props) {
  const { isOver, setNodeRef } = useDroppable({
    id: "droppableTest",
  });
  const dropStyle = {
    marginTop: "1rem",
    padding: "1rem 0 0 0",
    minHeight: "100px",
    width: "200px",
    border: isOver ? "3px solid blue" : `1px solid`,
  };
  return (
    <div style={dropStyle} ref={setNodeRef}>
      {items.map((item) => (
        <div style={{ marginBottom: ".5rem" }} key={item.id}>
          <button>{item.name}</button>
        </div>
      ))}
    </div>
  );
}
```

ã§ã¯è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚
ä»Šå›ã®è©±ã«ãŠã„ã¦ã€ã‚‚ã£ã¨ã‚‚é‡è¦ãªã®ãŒä»¥ä¸‹ã®é–¢æ•°éƒ¨åˆ†ã§ã™ã€‚

```jsx
const handleDragEnd = (event: DragEndEvent) => {
  if (event.over) {
    setItems((prev) => [
      ...prev,
      { id: uuidv4(), name: event.active.data.current?.name },
    ]);
  }
};
```

dnd kit ã§ã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.dndkit.com/api-documentation/context-provider#event-handlers)ã‚’ç¢ºèªã™ã‚‹ã¨ã€å¤§ããåˆ†ã‘ã¦ä»¥ä¸‹ 4 ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
â‘ onDragStart : ãƒ‰ãƒ©ãƒƒã‚¯å¯èƒ½è¦ç´ ãŒãƒ‰ãƒ©ãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã—ã¾ã™ã€‚
â‘¡onDragMove : ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’å‹•ã‹ã—ã„ã‚‹ã¨ãã«ç™ºç«ã—ã¾ã™ã€‚
â‘¢onDragOver : ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½é ˜åŸŸã®ä¸Šã«æ¥ãŸæ™‚ã«ç™ºç«ã—ã¾ã™ã€‚
â‘£onDragEnd : ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸæ™‚ã«ç™ºç«ã—ã¾ã™ã€‚
ä»Šå›ã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½é ˜åŸŸã§ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸæ™‚ã«ã€è¦ç´ ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒè¦ä»¶ãªã®ã§ â‘£ ã® onDragEnd ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ãã®ãŸã‚ã®é–¢æ•°ãŒå…ˆç¨‹æ²è¼‰ã—ãŸ handleDragEnd é–¢æ•°ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã®é–¢æ•°ã®ä¸­èº«ã‚’ã‚‚ã†å°‘ã—ã¿ã¦ã„ãã¾ã™ã€‚
å¼•æ•°ã® DragEndEvent å‹ã¯ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æœ‰ã—ã¦ã„ã¾ã™ã€‚

```jsx
interface DragEvent {
  activatorEvent: Event;
  active: Active;
  collisions: Collision[] | null;
  delta: Translate;
  over: Over | null;
}
export interface DragEndEvent extends DragEvent {}
```

ãã—ã¦ã€ä»Šå›ä½¿ç”¨ã—ã¦ã„ã‚‹ã®ã¯ active ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚
active ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãŸè¦ç´ ã®æƒ…å ±ã‚’æŒã£ã¦ã„ã¾ã™ã€‚
ãã—ã¦ã€over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸæ™‚ã«ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸä¸Šã§ã‚ã‚Œã°ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®æƒ…å ±ã‚’æŒã¡ã€ãã†ã§ãªã‘ã‚Œã° null ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚
ä»Šã®èª¬æ˜ã‹ã‚‰ã€ä»¥ä¸‹ã®æ¡ä»¶åˆ†å²ã—ã¦ã„ã‚‹ç†ç”±ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã§ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸæ™‚ã®ã¿ã€State ã«å€¤ã‚’è¿½åŠ ã™ã‚‹ã‚ˆã†ã™ã‚‹ãŸã‚ã¨æ¨æ¸¬ã§ãã¾ã™ã€‚

```jsx
if (event.over) {
  setItems((prev) => [
    ...prev,
    { id: uuidv4(), name: event.active.data.current?.name },
  ]);
}
```

å®Ÿéš›ã«ã€ä¸Šè¨˜åˆ†å²ã‚’ç„¡ãã—ãŸå‹•ããŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![createAllAreaDronContent.gif](/images/drag-and-drop-by-dnd-kit/createAllAreaDronContent.gif)
ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã§é›¢ã—ã¦ã„ãªã„ã®ã«ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«è¦ç´ ãŒç”Ÿæˆã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
ã“ã‚Œã‚’é˜²ããŸã‚ã«ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸæ™‚ã®ã¿å‡¦ç†ã‚’è¡Œã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ãã—ã¦ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸã¨ãã¯ã€ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãŸè¦ç´ ã®æƒ…å ±ã‚’æŒã¤ active ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã—ã¦ã€id ã‚’ç”Ÿæˆã—ã¤ã¤ State ã«è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚
ãªãŠã€active ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®`data.current`éƒ¨åˆ†ã§ã™ãŒã€ã“ã“ã¯ useDraggable é–¢æ•°ã‚’å‘¼ã³å‡ºã™æ™‚ã«è¨­å®šã—ãŸ data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£éƒ¨åˆ†ã®å€¤ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã—ã¦ã„ãŸã®ã§ã€name ã‚’è¨˜è¼‰ã—ã¦æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```jsx
useDraggable({
  id: "draggableTest",
  data: { name: "test" },
});
```

handleDragEnd é–¢æ•°ã®ä¸­èº«ã¯è¦‹ãŸã®ã§ã€å¾Œã¯ã“ã®é–¢æ•°ã‚’ DndContext ã® onDragEnd å±æ€§ã«ä»˜ä¸ã—ã¾ã™ã€‚
å¾Œã¯ã€dnd kit å›ºæœ‰ã®è©±ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
State ã‚’ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ map é–¢æ•°ã‚’ä½¿ã„ã¤ã¤è¦ç´ ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
ä»¥ä¸Šã‚’è¡Œãˆã°ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸã‚‰è¦ç´ ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![createElmInDropContent.gif](/images/drag-and-drop-by-dnd-kit/createElmInDropContent.gif)
ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸæ™‚ã®ã¿è¦ç´ ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã­ã€‚

### ä½™è«‡ ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã® data å±æ€§ã‚’å‹å®‰å…¨ã«ã™ã‚‹

å…ˆç¨‹è¦ç´ ã‚’ç”Ÿæˆã™ã‚‹å†…å®¹ã«ã¤ã„ã¦è¦‹ã¦ã„ã¾ã—ãŸãŒã€å®Ÿã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ãŸ`event.active.data.current?.name`ã® name éƒ¨åˆ†ã¯è£œå®ŒãŒåŠ¹ãã¾ã›ã‚“ã€‚
ãã®ãŸã‚ã€å…ˆç¨‹ã®ä¾‹ã§ã¯è‡ªåˆ†ã§ useDraggable é–¢æ•°ã§è¨­å®šã—ãŸå€¤ã‚’ç¢ºèªã—ã€ãã®å€¤ã‚’æ‰‹å…¥åŠ›ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ãƒŸã‚¹ãŒèµ·ãã‚„ã™ãã€Typescript ã‚’ä½¿ã£ã¦ã„ã‚‹ãƒ¡ãƒªãƒƒãƒˆã‚’æ´»ã‹ã›ã¦ã„ã¾ã›ã‚“ã€‚
ãã“ã§ã€[ã“ã¡ã‚‰ã®ã‚¤ã‚·ãƒ¥ãƒ¼](https://github.com/clauderic/dnd-kit/issues/935)ã‚’å‚è€ƒã«ã—ã¤ã¤ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã‚’ä½¿ã„æ‹¡å¼µã§ãã‚‹ã‚ˆã†ã«ã—ãŸã®ãŒä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚

```jsx
import {
    Active,
    Collision,
    Data,
    DndContextProps,
    Over,
    Translate,
    UseDraggableArguments,
    UseDroppableArguments,
    useDraggable as useOriginalDraggable,
    useDroppable as useOriginalDroppable,
} from "@dnd-kit/core";
export interface UseDroppableTypesafeArguments<DRO> extends Omit<UseDroppableArguments, "data"> {
    data: DRO;
}
export function useBaseDroppable<DRO extends Data>(props: UseDroppableTypesafeArguments<DRO>) {
    return useOriginalDroppable(props);
}
export interface UseDraggableTypesafeArguments<DRA> extends Omit<UseDraggableArguments, "data"> {
    data: DRA;
}
export function useBaseDraggable<DRA extends Data>(props: UseDraggableTypesafeArguments<DRA>) {
    return useOriginalDraggable(props);
}
interface TypesafeActive<DRA> extends Omit<Active, "data"> {
    data: React.MutableRefObject<DRA | undefined>;
}
interface TypesafeOver<DRO> extends Omit<Over, "data"> {
    data: React.MutableRefObject<DRO | undefined>;
}
interface DragEvent<DRA, DRO> {
    activatorEvent: Event;
    active: TypesafeActive<DRA>;
    collisions: Collision[] | null;
    delta: Translate;
    over: TypesafeOver<DRO> | null;
}
export interface DragStartEvent<DRA, DRO> extends Pick<DragEvent<DRA, DRO>, "active"> { }
export interface DragMoveEvent<DRA, DRO> extends DragEvent<DRA, DRO> { }
export interface DragOverEvent<DRA, DRO> extends DragMoveEvent<DRA, DRO> { }
export interface DragEndEvent<DRA, DRO> extends DragEvent<DRA, DRO> { }
export interface DragCancelEvent<DRA, DRO> extends DragEndEvent<DRA, DRO> { }
export interface DndContextTypesafeProps<DRA, DRO>
    extends Omit<
        DndContextProps,
        "onDragStart" | "onDragMove" | "onDragOver" | "onDragEnd" | "onDragCancel"
    > {
    onDragStart?(event: DragStartEvent<DRA, DRO>): void;
    onDragMove?(event: DragMoveEvent<DRA, DRO>): void;
    onDragOver?(event: DragOverEvent<DRA, DRO>): void;
    onDragEnd?(event: DragEndEvent<DRA, DRO>): void;
    onDragCancel?(event: DragCancelEvent<DRA, DRO>): void;
}
```

çµæ§‹è‰²ã€…æ›¸ã„ã¦ã„ã¾ã™ãŒã€ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ Omit ã§ data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å–ã‚Šé™¤ãã€å‹ãŒã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§ã‚ã‚‹ data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è‡ªå‰ã§è¿½åŠ ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚
ã“ã‚Œã«ã‚ˆã£ã¦ã€DndContext å†…ã®å„ç¨®ã‚¤ãƒ™ãƒ³ãƒˆã¯è¨­å®šã—ãŸå‹ãŒè£œå®ŒãŒã§ãã¾ã™ã—ã€useDraggable é–¢æ•°ã€useDroppable é–¢æ•°ã§è¨­å®šã™ã‚‹ data å±æ€§ã‚‚ãšã‚ŒãŒèµ·ãã«ãããªã‚Šã¾ã™ã€‚
ã§ã¯ã€å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¾ã™ã€‚
ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```jsx
import {
  UseDraggableTypesafeArguments,
  useBaseDraggable,
  DndContextTypesafeProps,
} from "./wrap-dnd-kit";
type BtnData = { name: string };
export interface BtnDndContextTypesafeProps
  extends DndContextTypesafeProps<BtnData, {}> {}
export const useBtnDraggable = (
  props: UseDraggableTypesafeArguments<BtnData>
) => useBaseDraggable < BtnData > props;
```

DndCotext ã«æ¸¡ã™å±æ€§ã«ã¤ã„ã¦ã®å‹ã¨ã€data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å‹ãŒã¤ã„ãŸ useBaseDraggable é–¢æ•°ã®æ‹¡å¼µç‰ˆã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’å®šç¾©ã—ãŸå¾Œã€DndContext ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```jsx
import { DndContext, DragEndEvent } from "@dnd-kit/core";
import DraggableBase from "./DraggableBase";
import DrppabbleBase from "./DropabbleBase";
import { useState } from "react";
import { v4 as uuidv4 } from 'uuid'
import { BtnDndContextTypesafeProps } from "./useBtnDndKit";
export default function DndContextBase() {
    const [items, setItems] = useState<{ id: string, name: string }[]>([])
    const contextProps: BtnDndContextTypesafeProps = {
        onDragEnd: (event) => {
            const dragName = event.active.data.current?.name;
            if (event.over && dragName) {
                setItems((prev) => [...prev, { id: uuidv4(), name: dragName }])
            }
        }
    }
    return (
        <DndContext {...contextProps}>
            <DraggableBase></DraggableBase>
            <DrppabbleBase items={items}></DrppabbleBase>
        </DndContext>
    )
}
```

DndContext ã«æ¸¡ã™ Props ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®šç¾©ã—ãŸå¾Œã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ§‹æ–‡ã§æ¸¡ã—ã¦ã„ã¾ã™ã€‚
onDragEnd ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸­èº«ã¯å…ˆç¨‹ã¨ã»ã¼åŒã˜ã§ã™ãŒã€å‹ãŒã¡ã‚ƒã‚“ã¨ã¤ã„ãŸã“ã¨ã§ undefined ã‚’é™¤å»ã—ã¦ã€State ã«ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã ã‘ã§ã‚‚ã€å‹è£œå®ŒãŒåŠ¹ãã¤ã¤å‹•ãã¾ã™ãŒã€useDraggable é–¢æ•°ã§å®šç¾©ã—ãŸ data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãšã‚Œã‚‹ã®ã¯æ€–ã„ã®ã§ã€DraggableBase é–¢æ•°ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```jsx
import { useBtnDraggable } from "./useBtnDndKit";
export default function DraggableBase() {
  const { listeners, setNodeRef, transform } = useBtnDraggable({
    id: "draggableTest",
    data: { name: "test" },
  });
  const style = transform
    ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
      }
    : undefined;
  return (
    <button ref={setNodeRef} style={style} {...listeners}>
      ãƒ†ã‚¹ãƒˆ
    </button>
  );
}
```

useBtnDraggable é–¢æ•°ã‚’ä½¿ã†ã“ã¨ã§ã€data ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯`{name:string}`ã®å‹ã§ã—ã‹å®šç¾©å‡ºæ¥ãªããªã‚Šã¾ã™ã€‚
ã“ã‚Œã§å‹ã®è£œå®ŒãŒåŠ¹ãã¤ã¤ã€å‹ã®ãšã‚ŒãŒèµ·ãã«ãããªã‚Šã¾ã™ã€‚
ã‚‚ã†ã¡ã‚‡ã„æ”¹å–„ã—ãŸã„éƒ¨åˆ†ã¯ã‚ã‚Šã¾ã™ãŒã€`event.active.data.current`ã«å‹ãŒã¤ã‘ã‚ŒãŸã®ã¯å¤§ãã„ã§ã™ã€‚
ä»Šå¾Œã€è¤‡æ•°ã®ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆã€å­˜åœ¨ã—ãªã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®šç¾©ã«æ´»ç”¨ã—ã¦è¡Œã‘ãŸã‚‰ã¨æ€ã„ã¾ã™ã€‚

### ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã™ã‚‹

ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã§è¦ç´ ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã—ãŸã€‚
ã—ã‹ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«è¦ç´ ã‚’ç”Ÿæˆã—ãŸã¯ã„ã„ã‘ã©ã€æœ¬æ¥ç”Ÿæˆã—ãŸã‹ã£ãŸå ´æ‰€ã¨ã¯é•ã£ãŸã‹ã‚‰ã€é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆãŸã„å ´åˆã¯ã‚Šã¾ã™ã€‚
dnd kit ã¯ãã†ã„ã£ãŸè¦æœ›ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
ãªã®ã§ã€ã“ã“ã§ã¯è¦ç´ ã®ä¸¦ã¹æ›¿ãˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
ã¾ãšã¯å®Œæˆã—ãŸã‚³ãƒ¼ãƒ‰å…¨ä½“ã§ã™ã€‚
ãŠãŠã‚‚ã¨ã® DndContextBase é–¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```jsx
import { DndContext, DragEndEvent } from "@dnd-kit/core";
import DraggableBase from "./DraggableBase";
import DrppabbleBase from "./DropabbleBase";
import { useState } from "react";
import { v4 as uuidv4 } from 'uuid'
import { BtnDndContextTypesafeProps, BtnDragEndEvent } from "./useBtnDndKit";
import { arrayMove } from "@dnd-kit/sortable";
export default function DndContextBase() {
    const [items, setItems] = useState<{ id: string, name: string }[]>([])
    const handleSort = (event: BtnDragEndEvent) => {
        const { active, over } = event;
        setItems((items) => {
            const oldIndex = items.findIndex((item) => item.id === active.id)
            const newIndex = items.findIndex((item) => item.id === over?.id)
            return arrayMove(items, oldIndex, newIndex);
        });
    }
    const addItem = (event: BtnDragEndEvent) => {
        const dragName = event.active.data.current?.name;
        if (event.over && dragName) {
            setItems((prev) => [...prev, { id: uuidv4(), name: dragName }])
        }
    }
    const contextProps: BtnDndContextTypesafeProps = {
        onDragEnd: (event) => {
            addItem(event);
            handleSort(event)
        }
    }
    return (
        <DndContext {...contextProps}>
            <DraggableBase></DraggableBase>
            <DrppabbleBase items={items}></DrppabbleBase>
        </DndContext>
    )
}
```

å…ˆç¨‹ä½™è«‡ã§ä½œæˆã—ãŸãƒ©ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã« DragEndEvent ã«é–¢ã‚ã‚‹å‹ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```jsx
import {
  UseDraggableTypesafeArguments,
  useBaseDraggable,
  DndContextTypesafeProps,
  DragEndEvent,
} from "./wrap-dnd-kit";
type BtnData = { name: string };
export interface BtnDndContextTypesafeProps
  extends DndContextTypesafeProps<BtnData, {}> {}
export interface BtnDragEndEvent extends DragEndEvent<BtnData, {}> {}
export const useBtnDraggable = (
  props: UseDraggableTypesafeArguments<BtnData>
) => useBaseDraggable < BtnData > props;
```

ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚½ãƒ¼ãƒˆå¯èƒ½ãªé ˜åŸŸã‚’è¨­å®šã—ã¾ã™ã€‚

```jsx
import { useDroppable } from "@dnd-kit/core";
import { SortableContext } from "@dnd-kit/sortable";
import SortableBase from "./SortableBase";
export type Props = {
  items: { id: string, name: string }[],
};
export default function DrppabbleBase({ items }: Props) {
  const { isOver, setNodeRef } = useDroppable({
    id: "droppableTest",
  });
  const dropStyle = {
    marginTop: "1rem",
    padding: "1rem 0 0 0",
    minHeight: "100px",
    width: "200px",
    border: isOver ? "3px solid blue" : `1px solid`,
  };
  return (
    <div style={dropStyle} ref={setNodeRef}>
      <div
        style={{
          display: "flex",
          flexDirection: "column",
          justifyContent: "center",
          gap: ".5rem",
        }}
      >
        <SortableContext items={items}>
          {items.map((item) => (
            <SortableBase
              key={item.id}
              id={item.id}
              name={item.name}
            ></SortableBase>
          ))}
        </SortableContext>
      </div>
    </div>
  );
}
```

ã‚½ãƒ¼ãƒˆã§ãã‚‹ã‚ˆã†è¦ç´ ã‚’ä½œæˆã—ã¾ã™ã€‚

```jsx
import { useSortable } from "@dnd-kit/sortable";
type Props = { id: string, name: string };
export default function SortableBase({ id, name }: Props) {
  const { setNodeRef, listeners } = useSortable({ id });
  return (
    <button ref={setNodeRef} {...listeners}>
      {name}
    </button>
  );
}
```

æœ€å¾Œã«ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã¨ã¯ç›´æ¥é–¢ä¿‚ãªã„ã§ã™ãŒã€ã‚½ãƒ¼ãƒˆã—ãŸã“ã¨ã‚’åˆ†ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã«ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```jsx
import { useBtnDraggable } from "./useBtnDndKit";
export default function DraggableBase() {
  const { listeners, setNodeRef, transform } = useBtnDraggable({
    id: "draggableTest",
    data: { name: "test" },
  });
  const {
    listeners: listeners2,
    setNodeRef: setNodeRef2,
    transform: transform2,
  } = useBtnDraggable({
    id: "draggableTest2",
    data: { name: "test2" },
  });
  const style = transform
    ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
      }
    : undefined;
  const style2 = transform2
    ? {
        transform: `translate3d(${transform2.x}px, ${transform2.y}px, 0)`,
      }
    : undefined;
  return (
    <>
      <button ref={setNodeRef} style={style} {...listeners}>
        ãƒ†ã‚¹ãƒˆ
      </button>
      <button ref={setNodeRef2} style={style2} {...listeners2}>
        ãƒ†ã‚¹ãƒˆ2
      </button>
    </>
  );
}
```

ã“ã†ã™ã‚Œã°ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚½ãƒ¼ãƒˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![baseSortElm.gif](/images/drag-and-drop-by-dnd-kit/baseSortElm.gif)
ã§ã¯ã‚³ãƒ¼ãƒ‰ã®ä¸­èº«ã«ã¤ã„ã¦ã¿ã¦ã„ãã¾ã™ã€‚
ã¾ãšã¯ã‚½ãƒ¼ãƒˆé ˜åŸŸã®ç¢ºä¿ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã« SortableContext ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å›²ã‚€ã“ã¨ã§ã€å­ä¾›ã®è¦ç´ ã¯ã‚½ãƒ¼ãƒˆå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

```jsx
<SortableContext items={items}>
  {items.map((item) => (
    <SortableBase key={item.id} id={item.id} name={item.name}></SortableBase>
  ))}
</SortableContext>
```

ãŸã ã€items å±æ€§ã¯å¿…è¦ã§ã™ã€‚
ã“ã® items å±æ€§ã¯ä»¥ä¸‹ã®å‹å®šç¾©ã‹ã‚‰åˆ†ã‹ã‚‹ã‚ˆã†ã«ã€string ã‚‚ã—ãã¯ number å‹ã®é…åˆ—ã‹ã€id ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ ¼ç´ã—ã¾ã™ã€‚

```jsx
export interface Props {
    items: (UniqueIdentifier | {
        id: UniqueIdentifier;
    })[]
		//...ç•¥
}
export declare type UniqueIdentifier = string | number;
```

ã“ã®å±æ€§ã«ã‚ˆã£ã¦ã€ã‚½ãƒ¼ãƒˆé ˜åŸŸã«ã‚ã‚‹ã©ã®è¦ç´ ãŒä½•ç•ªç›®ã«å­˜åœ¨ã™ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚å¿…é ˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã‚½ãƒ¼ãƒˆé ˜åŸŸã¯ç¢ºä¿ã§ããŸã®ã§ã€ã‚½ãƒ¼ãƒˆè¦ç´ ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚
ã‚½ãƒ¼ãƒˆè¦ç´ ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€useSortable é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€å‹•ã‹ã—ãŸã„è¦ç´ ã«å¿…è¦ãªå±æ€§ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

```jsx
const { setNodeRef, listeners } = useSortable({ id });
return (
  <button ref={setNodeRef} {...listeners}>
    {name}
  </button>
);
```

ã‚½ãƒ¼ãƒˆè¦ç´ ãŒè­˜åˆ¥ã§ãã‚‹ã‚ˆã†ã«ã€useSortable é–¢æ•°ã¸ä¸€æ„ã® ID ã‚’æ¸¡ã—ã€è¡çªåˆ¤å®šãŒã§ãã‚‹`setNodeRef`ã¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã«`listeners`ã‚’ä»˜ä¸ã—ã¾ã™ã€‚
ä½¿ã„æ–¹è‡ªä½“ã¯ã€å¤§ä½“ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—ã®æ™‚ã¨åŒã˜ã§ã™ã€‚
ä»¥ä¸Šã§ã€ã‚½ãƒ¼ãƒˆã‚’è¡Œã†æº–å‚™ã¯ã§ãã¾ã—ãŸã€‚
ãŸã ã€ã“ã‚Œã ã‘ã§ã‚½ãƒ¼ãƒˆã‚’è¡Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
ã‚½ãƒ¼ãƒˆã®å‡¦ç†è‡ªä½“ã¯ DndContext ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® onDragEnd å±æ€§ã§è¡Œã†å¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚
ãªã®ã§ã€DndContextBase é–¢æ•°ã® onDragEnd ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£éƒ¨åˆ†ã®å‡¦ç†ã‚’é–¢æ•°ã«åˆ†å‰²ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

```jsx
const handleSort = (event: BtnDragEndEvent) => {
  const { active, over } = event;
  setItems((items) => {
    const oldIndex = items.findIndex((item) => item.id === active.id);
    const newIndex = items.findIndex((item) => item.id === over?.id);
    return arrayMove(items, oldIndex, newIndex);
  });
};
const addItem = (event: BtnDragEndEvent) => {
  const dragName = event.active.data.current?.name;
  if (event.over && dragName) {
    setItems((prev) => [...prev, { id: uuidv4(), name: dragName }]);
  }
};
const contextProps: BtnDndContextTypesafeProps = {
  onDragEnd: (event) => {
    addItem(event);
    handleSort(event);
  },
};
```

ã“ã“ã§é‡è¦ãªã®ã¯ arrayMove é–¢æ•°ã§ã™ã€‚
[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://github.com/clauderic/dnd-kit/blob/master/packages/sortable/src/utilities/arrayMove.ts)ã‚’ç¢ºèªã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```jsx
/**
 * Move an array item to a different position. Returns a new array with the item moved to the new position.
 */
export function arrayMove<T>(array: T[], from: number, to: number): T[] {
  const newArray = array.slice();
  newArray.splice(
    to < 0 ? newArray.length + to : to,
    0,
    newArray.splice(from, 1)[0]
  );
  return newArray;
}
```

å‹•ã‹ã—ãŸã„è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ index ç•ªå·ã‚’ç¬¬äºŒå¼•æ•°ã«æŒ‡å®šã—ã¦ã€å‹•ã‹ã™ index ç•ªå·å…ˆã‚’ç¬¬ä¸‰å¼•æ•°ã«è¨­å®šã™ã‚‹ã¨é…åˆ—ã‚’ã„ã„æ„Ÿã˜ã«æ“ä½œã—ã¦ãã‚Œãã†ã§ã™ã€‚
ãªã®ã§ã€ä»Šå›ã¯ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹è¦ç´ ãŒå­˜åœ¨ã—ã¦ã„ãŸ index ç•ªå·ã‚’ findIndex ãƒ¡ã‚½ãƒƒãƒ‰ã§å–å¾—ã—ã€ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸæ™‚ã®ä¸‹ã«ã„ãŸè¦ç´ ã® index ç•ªå·ã‚‚åŒæ§˜ã« findeIndex ãƒ¡ã‚½ãƒƒãƒ‰ã§å–å¾—ã—ã¦ã„ã¾ã™ã€‚

```jsx
const oldIndex = items.findIndex((item) => item.id === active.id);
const newIndex = items.findIndex((item) => item.id === over?.id);
```

ãªãŠã€over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ãŒ`setNodeRef`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ä¸€ç•ªä¸Šã®è¦ç´ ã®å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚
ãã®ãŸã‚ä»¥ä¸‹ã®ã‚ˆã†ãªè¦ç´ ãŒã‚ã£ãŸå ´åˆã€è¦ç´  â‘¡ ã®ä¸Šã§ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸã‚‰ over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯è¦ç´  â‘¡ ã®å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚
![setNodeRef.drawio.png](</images/drag-and-drop-by-dnd-kit/setNodeRef.drawio_(1).png>)
ä¸€æ–¹ã§ã€è¦ç´  â‘¢ ã§ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸã¨ã—ã¦ã‚‚ã€`setNodeRef`ã¯ãªã„ãŸã‚ over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯è¦ç´  â‘¢ ã®å€¤ã‚’å–å¾—ã—ã¾ã›ã‚“ã€‚
ãã®ä»£ã‚ã‚Šã€è¦ç´  â‘¢ ã‚’å›²ã£ã¦ã„ã‚‹è¦ç´  â‘  ã¯`setNodeRef`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€over ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯è¦ç´  â‘  ã®å€¤ã‚’å–å¾—ã—ã¾ã™ã€‚
ã‚ˆã£ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸé ˜åŸŸã«ã„ãŸã‚½ãƒ¼ãƒˆå¯èƒ½ãªè¦ç´ ã® index ç•ªå·ã«ç§»å‹•ã•ã›ã€è©²å½“ã® index ç•ªå·ä»¥é™ã«ã‚ã‚‹è¦ç´ ã¯ä¸€ã¤ãšã¤ index ç•ªå·ãŒå¢—ãˆã‚‹ã“ã¨ã«ã‚ˆã£ã¦ä¸¦ã¹æ›¿ãˆãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã¨ç†è§£ã§ãã¾ã™ã€‚

```jsx
setItems((items) => {
  const oldIndex = items.findIndex((item) => item.id === active.id);
  const newIndex = items.findIndex((item) => item.id === over?.id);
  return arrayMove(items, oldIndex, newIndex);
});
```

ä»¥ä¸Šã§åŸºæœ¬çš„ãªãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚„ã€è¦ç´ ã®ä¸¦ã¹æ›¿ãˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ãªã®ã§ã€ã“ã“ã‹ã‚‰ã¯ dnd kit ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ä»–ã®æ©Ÿèƒ½ã‚‚ä½¿ã„ã¤ã¤ã€æœ€åˆã«ç¤ºã—ãŸä»¥ä¸‹ã®å‹•ãã®å®Ÿè£…ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚
![newcreateElmDragAndDrop.gif](/images/drag-and-drop-by-dnd-kit/newcreateElmDragAndDrop2.gif)

## å®Œæˆã—ãŸã‚³ãƒ¼ãƒ‰ã®è§£èª¬

### å¤§å…ƒéƒ¨åˆ†

ã¾ãšã¯ DndContext ã‚’ä½¿ã£ã¦ã„ã‚‹å¤§å…ƒã‹ã‚‰è§£èª¬ã—ã¾ã™ã€‚

```jsx
// ãƒ‰ãƒ­ãƒƒãƒ—ã§ãã‚‹é ˜åŸŸã«è¡¨ç¤ºã•ã‚Œã‚‹è¦ç´ ã®ãƒ‡ãƒ¼ã‚¿ç”¨ã®State
    const [elms, setElms] = useState<{ id: string, name: string }[]>([])
    // ãƒ‰ãƒ©ãƒƒã‚¯ä¸­ã®è¦ç´ ãƒ‡ãƒ¼ã‚¿ç”¨ã®State
    const [activeElm, setActiveElm] = useState<{ id: string, name: string, virtualId?: string }>()
    // ãƒ‰ãƒ©ãƒƒã‚¯ã™ã‚‹è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚‚ã®ã‹ã‚’åˆ¤å®šã™ã‚‹State
    const [isDropContent, setIsDropContent] = useState(false)
    // ãƒ‰ãƒ©ãƒƒã‚¯ã™ã‚‹æ–¹å‘ã®åˆ¶ç´„ã‚’ç®¡ç†ã™ã‚‹State
    // åŸºæœ¬çš„ã«ã€Œ@dnd-kit/modifiersã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®å€¤ã‚’ä»˜ä¸ã™ã‚‹
    const [modifiers, setModifiers] = useState<Modifier[]>([])
```

ã“ã¡ã‚‰ã¯åŸºæœ¬çš„ã« state å®šç¾©ã§ã™ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆé€šã‚Šã®å†…å®¹ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ä¸€ç‚¹è£œè¶³ãŒã‚ã‚Šã¾ã™ã€‚
ä¸€ç•ªä¸‹ã® Modifier å‹ã®é…åˆ—ã‚’å®šç¾©ã—ã¦ã„ã‚‹ State ã§ã™ãŒã€ã“ã‚Œã¯ dnd kit ã§æä¾›ã•ã‚Œã¦ã„ã‚‹[Modifiers](https://docs.dndkit.com/api-documentation/modifiers)ã¨ã„ã†æ©Ÿèƒ½ã®å€¤ãŒæ ¼ç´ã—ã¾ã™ã€‚
Modifiers ã¯å‡„ãã‚¶ãƒƒã‚¯ãƒªè¨€ã†ã¨ã€ãƒ‰ãƒ©ãƒƒã‚¯å¯èƒ½ãªæ–¹å‘ã‚’é™å®šã™ã‚‹å€¤ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã‚’ DndConetxt ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã™ã‚‹ã¨ã€å†…éƒ¨ã®ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã®å‹•ã‹ã™æ–¹å‘ã‚’é™å®šã§ãã¾ã™ã€‚

```jsx
<DndContext modifiers={modifiers}>//...ç•¥</DndContext>
```

æ¬¡ã«ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’ã¤ã‹ã‚“ã ã¨ãã®å‡¦ç†ã‚’ã¿ã¦ã„ãã¾ã™ã€‚

```jsx
// ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã«ç™ºç«ã™ã‚‹é–¢æ•°
const handleDragStart = (event: DragStartEvent) => {
  // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ã«é–¢ã‚ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
  const { active } = event;
  // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å­˜åœ¨ã™ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹
  const isExistInDropContent = elms
    .map((i) => i.id)
    .includes(active.id.toString());
  //ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸè¦ç´ ã®idä½œæˆã€‚ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ã§idã‚’ä½œæˆã™ã‚‹
  const id = isExistInDropContent ? active.id.toString() : uuidv4();
  // ãƒ‰ãƒ©ãƒƒã‚¯ä¸­ã«ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã§ä»®ç”Ÿæˆã•ã‚Œã‚‹è¦ç´ ã®IDã€‚ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®ã‚‚ã®ã‚’ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹ã¨ãã¯undefined
  const virtualId = isExistInDropContent ? undefined : uuidv4();
  setActiveElm({ id, name: active.data.current?.name, virtualId });
  setIsDropContent(isExistInDropContent);
  // ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®ã‚‚ã®ã®å ´åˆã€å‹•ã‹ã›ã‚‹æ–¹å‘ã‚’å‚ç›´æ–¹å‘ã®ã¿ã«åˆ¶é™ã™ã‚‹
  isExistInDropContent
    ? setModifiers([restrictToVerticalAxis])
    : setModifiers([]);
};
```

å‡¦ç†ã®å†…å®¹ã¯ã‚³ãƒ¡ãƒ³ãƒˆé€šã‚Šã§ã™ãŒã€ã“ã“ã§ã¯ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹è¦ç´ ã‚’ State ã«æ ¼ç´ã™ã‚‹ã“ã¨ã¨ã€ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®ã‚‚ã®ã‹ã©ã†ã‹ã§è¨­å®šã™ã‚‹å€¤ã‚’å¤‰ãˆã¦ã„ã¾ã™ã€‚
è£œè¶³çš„ã«èª¬æ˜ã™ã‚‹éƒ¨åˆ†ã¯`virtualId`éƒ¨åˆ†ã§ã™ã€‚
ã“ã®é …ç›®ã‚’è¨­ã‘ã¦ã„ã‚‹ã®ã¯ã€ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã‚‚ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«è¦ç´ ã‚’ç”Ÿæˆã—ã¦å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ã¯ã—ãŸã„ã‘ã©ã€ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸæ™‚ã¯é€šå¸¸ã® id ã§ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã—ãŸã„ãŸã‚ã§ã™ã€‚
ã“ã®`virtualId`ã‚’è¨­ã‘ãšã€id ã ã‘ã§è¡Œã†ã¨ãƒ‰ãƒ©ãƒƒã‚¯ä¸­ã«ã§ããŸè¦ç´ ã«åŠ ãˆã¦ã€ãƒ‰ãƒ©ãƒƒã‚¯ã‚’è¾ã‚ãŸæ™‚ã‚‚è¦ç´ ãŒç”Ÿæˆã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
ãã‚Œã‚’é˜²ããŸã‚ã«ã€æœ€çµ‚çš„ãªè¦ç´ ç”Ÿæˆã¾ã§ã¯`virtualId`ã§ä»®ç”Ÿæˆã‚’è¡Œã„ã€æ­£å¼ã«ç”Ÿæˆã•ã‚Œã‚‹éš›ã¯ id ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ãã®ãŸã‚ã«ã‚‚`virtualId`ã‚’è¨­ã‘ã¦ã„ã¾ã™ã€‚
æ¬¡ã«ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã¨æ¥è§¦ã—ãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã«ã¤ã„ã¦ã§ã™ã€‚

```jsx
const handleDragOver = (e: DragOverEvent) => {
  const { over } = e;
  //ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸå ´æ‰€ã«ã‚ã£ãŸè¦ç´ ã®id
  const overId = over?.id;
  // ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãªã„å ´åˆã‚„ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå¤–ã§ãƒ‰ãƒ©ãƒƒã‚¯ã—ãŸè¦ç´ ã‚’å‹•ã‹ã—ã¦ã„ã‚‹å ´åˆå‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹ã€‚
  if (!overId || !activeElm) {
    // ç”Ÿæˆã—ãŸä»®è¦ç´ ã‚’å‰Šé™¤ã™ã‚‹
    setElms(() => elms.filter((elm) => elm.id !== activeElm?.virtualId));
    return;
  }
  // ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å…¥ã‚Šã€åŒã˜è¦ç´ ãŒç„¡ã‘ã‚Œã°è¦ç´ ã‚’è¿½åŠ ã™ã‚‹
  if (
    activeElm.virtualId &&
    !elms.some((elm) => elm.id === activeElm.virtualId)
  ) {
    setElms([
      ...elms.slice(0, elms.length),
      { id: activeElm.virtualId, name: e.active.data.current?.name },
    ]);
  }
  // ä»®ã®è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å‹•ã‹ã—ã¦ã„ã‚‹æ™‚ã«ã€ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ã€‚
  if (elms.some((elm) => elm.id === activeElm.virtualId)) {
    setElms((items) => {
      const oldIndex = items
        .map((i) => i.id)
        .findIndex((val) => val === activeElm.virtualId);
      const newIndex = items
        .map((i) => i.id)
        .findIndex((val) => val === over.id);
      // è¦ç´ ã‚’æŒ‡å®šã®å ´æ‰€ã«ä¸¦ã³æ›¿ãˆã‚‹
      return arrayMove(items, oldIndex, newIndex);
    });
  }
};
```

ã“ã“ã¯ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ã‚‹éš›ã«è¦ç´ ã‚’ä»®ç”Ÿæˆã™ã‚‹éƒ¨åˆ†ã¨ã€ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹å‡¦ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ä»¥ä¸‹ã®å‹•ä½œéƒ¨åˆ†ã§ã™ã€‚
![onlyVirtualElmSor.gif](/images/drag-and-drop-by-dnd-kit/onlyVirtualElmSor.gif)
ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æœ€å¾Œã§ã‚ã‚‹ã€ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’é›¢ã—ãŸæ™‚ã®å‡¦ç†ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ã¾ã™ã€‚

```jsx
// ãƒ‰ãƒ©ãƒƒã‚¯çµ‚äº†æ™‚ã«ç™ºç«ã™ã‚‹é–¢æ•°
const handleDragEnd = (e: DragEndEvent) => {
  // å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã€‚
  // Stateã®seté–¢æ•°ã¯éåŒæœŸãªã®ã§ã€ã“ã“ã§å€¤ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚é–¢æ•°å†…ã®å‡¦ç†ã«ã¯å½±éŸ¿ãªã„ã€‚
  setActiveElm(undefined);
  // ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚¤ãƒ™ãƒ³ãƒˆ(over)ã‚’å–å¾—ã€‚
  const { over } = e;
  // ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãªã„å ´åˆã‚„ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå¤–ã§ãƒ‰ãƒ©ãƒƒã‚¯ã‚’è¾ã‚ãŸå ´åˆå‡¦ç†ã‚’ä¸­æ–­ã™ã‚‹ã€‚
  if (!over || !activeElm) {
    // ä»®è¦ç´ ãŒç”Ÿæˆã•ã‚Œã¦ã„ãŸã¨ãã¯å‰Šé™¤ã™ã‚‹
    setElms(() => elms.filter((elm) => elm.id !== activeElm?.virtualId));
    return;
  }
  // ä»®è¦ç´ ã‚’å®Ÿéš›ã®è¦ç´ ã¨ã—ã¦ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã¸åæ˜ ã•ã›ã¦ã„ã‚‹
  setElms(() =>
    elms.map((elm) => ({
      id: elm.id === activeElm.virtualId ? activeElm.id : elm.id,
      name: elm.name,
    }))
  );
  // ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚¯ã—ã¦ã„ãŸå ´åˆã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã‚‹
  if (elms.some((elm) => elm.id === activeElm.id)) {
    setElms((items) => {
      const oldIndex = items
        .map((i) => i.id)
        .findIndex((val) => val === activeElm.id);
      const newIndex = items
        .map((i) => i.id)
        .findIndex((val) => val === over.id);
      return arrayMove(items, oldIndex, newIndex);
    });
  }
};
```

æœ€å¾Œã®éƒ¨åˆ†ã«ä¼¼ãŸå‡¦ç†ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã‚’ã‚½ãƒ¼ãƒˆã—ãŸæ™‚ã«å®Ÿéš›ç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã§ã™ã€‚
ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã®äºˆæƒ³ã¨æ¥è§¦ã—ãŸæ™‚ã®å‡¦ç†ã§è¨˜è¼‰ã—ã¦ã„ãŸã®ã¯ã€ä»®è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã‚‹ãŸã‚ã§ã—ãŸãŒã“ã“ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã‚‹ãŸã‚ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
![onlyVirtualElmSort2.gif](/images/drag-and-drop-by-dnd-kit/onlyVirtualElmSort2.gif)
ä»¥ä¸ŠãŒ DndContext ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹éƒ¨åˆ†ã®ä¸»è¦ãªæ©Ÿèƒ½ã§ã™ã€‚
æ¬¡ã«ãƒ‰ãƒ©ãƒƒã‚¯è¦ç´ ã‚’è¨˜è¼‰ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è§£èª¬ã¨ã„ããŸã„ã¨ã“ã‚ã§ã™ãŒã€åŸºæœ¬çš„ãªå®Ÿè£…ã®æ™‚ã«è¨˜è¼‰ã—ãŸä»¥ä¸Šã®ã‚‚ã®ã¯ãªã„ã®ã§ã€çœç•¥ã—ã¾ã™ã€‚

### ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ãŒã€ã“ã“ã‚‚åŸºæœ¬çš„ãªå®Ÿè£…ã§è§£èª¬ã—ãŸå†…å®¹ãŒå¤šã„ã®ã§ã€ã‚ã¾ã‚Šè§£èª¬ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãŸã ã€ä»¥ä¸‹ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©ã«ã¤ã„ã¦ã ã‘è£œè¶³ã—ã¾ã™ã€‚ã€Œ

```jsx
const dropStyle = {
  padding: "1rem 0 0 0",
  minHeight: "100px",
  width: "200px",
  border: isOver && !isDropContent ? "3px solid blue" : `1px solid`,
};
```

border ã®éƒ¨åˆ†ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå¤–ã®è¦ç´ ãŒãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å…¥ã£ã¦ããŸæ™‚ã®ã¿é’æ ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
![showBorder.gif](/images/drag-and-drop-by-dnd-kit/showBorder.gif)
ã“ã‚Œã«ã‚ˆã£ã¦ã€ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸå†…ã«å…¥ã£ãŸã“ã¨ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‹ãªã¨æ€ã„è¨­å®šã—ã¾ã—ãŸã€‚
ãŸã ã€ä¸Šè¨˜æ¡ä»¶ä»¥å¤–ã§é’æ ã«ãªã£ã¦ã—ã¾ã†ã¨æ“ä½œã®é‚ªé­”ã«ãªã‚‹ã¨æ€ã„ã€ãã‚Œä»¥å¤–ã®å ´åˆã§ã¯ç‰¹ã«æ ç·šã®å¤‰æ›´ã‚’ã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

### ã‚½ãƒ¼ãƒˆå¯èƒ½ãªè¦ç´ 

æœ€å¾Œã«ã‚½ãƒ¼ãƒˆè¦ç´ ã«ã¤ã„ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚
åŸºæœ¬çš„ãªæ©Ÿèƒ½ã«ã¤ã„ã¦ã¯ã™ã§ã«è¨€åŠã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®éƒ¨åˆ†ã¯è£œè¶³ã—ã¾ã™ã€‚

```jsx
import { CSS } from "@dnd-kit/utilities";
//...ç•¥
const {
  //...ç•¥
  transform,
  transition,
} = useSortable({ id: elm.id });
return (
  <div
    style={{
      transform: CSS.Transform.toString(transform),
      transition,
    }}
  >
    //...ç•¥
  </div>
);
```

åŸºæœ¬çš„ãªå®Ÿè£…ã§ã¯ä¸¦ã¹æ›¿ãˆè‡ªä½“ã¯ã§ãã¦ã„ã¾ã—ãŸãŒã€å¤‰æ›´ã™ã‚‹éš›ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªãã€åˆè¦‹ã§ã¯ä¸¦ã¹æ›¿ãˆãŒè¡Œãˆã¦ã„ã‚‹ã®ã‹åˆ†ã‹ã‚Šã«ãã„çŠ¶æ…‹ã§ã™ã€‚
ä¸Šè¨˜ã®çŠ¶æ…‹ã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã«ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒè§£æ¶ˆæ–¹æ³•ã®ä¸€ã¤ã¨ãªã‚Šã¾ã™ã€‚
ã“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã™ã‚‹ã®ãŒã€`transform`ã¨`transition`ã«ãªã‚Šã¾ã™ã€‚
ã“ã‚Œã‚‰ã®å€¤ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ä¸¦ã¹æ›¿ãˆã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒä»˜ä¸ã•ã‚Œã€ç¾åœ¨ã®ä¸¦ã¹æ›¿ãˆã®çŠ¶æ…‹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚
ãªãŠã€ä½ç½®å¤‰æ›´ã‚’è¡Œã† transform ã¯ useSortable é–¢æ•°ã®å€¤ã‚’ãã®ã¾ã¾ä»˜ä¸ã—ã¦ã‚‚ä¸Šæ‰‹ãå‹•ãã¾ã›ã‚“ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«åº§æ¨™ã«ã¤ã„ã¦ã®å€¤ã¯ä¿æŒã—ã¦ã„ã‚‹ã®ã§ã™ã€transform ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ç”¨ã®å½¢ã«ãªã£ã¦ã„ã¾ã›ã‚“ã€‚

```jsx
export declare type Transform = {
    x: number;
    y: number;
    scaleX: number;
    scaleY: number;
};
```

ãã“ã§ã€`@dnd-kit/utilities`ã® CSS ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã® toString ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€å–å¾—ã—ãŸåº§æ¨™ã‚’ã„ã„æ„Ÿã˜ã« transform ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å‹•ãã‚ˆã†ãªå€¤ã«å¤‰æ›ã—ã¦ãã‚Œã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ dnd kit ã‚’ç”¨ã„ãŸãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®è§£èª¬ã¨ãƒ‰ãƒ©ãƒƒã‚¯ãƒ»ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã‚’ä½¿ã£ãŸè¦ç´ ç”Ÿæˆã®ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’è¡Œã„ã¾ã—ãŸã€‚
çµæ§‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒå¤§ãããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€åŸºæœ¬çš„ãªæ©Ÿèƒ½ã«ã¤ã„ã¦è¨˜è¼‰ã§ããŸã®ã§æº€è¶³ã§ã™ã€‚
ãŸã ã€ä»Šå›å®Ÿè£…ã—ãŸã®ã¯ã‚ãã¾ã§åŸºæœ¬çš„ãªå‹•ä½œã®ã¿ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã¾ã ã¾ã æ©Ÿèƒ½ã‚ã‚Šã€æ´»ç”¨ã§ãã‚‹å ´é¢ã¯ã‚ã‚‹ã¨ãŠã‚‚ã„ã¾ã™ã®ã§æ°—ã«ãªã‚‹æ–¹ã¯æ˜¯éã¨ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
